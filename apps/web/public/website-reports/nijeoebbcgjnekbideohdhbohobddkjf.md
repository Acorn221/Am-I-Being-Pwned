# Security Analysis Report: ePub Reader

## Extension Metadata
- **Extension Name**: ePub Reader
- **Extension ID**: nijeoebbcgjnekbideohdhbohobddkjf
- **User Count**: ~60,000
- **Version**: 3.0.0
- **Manifest Version**: 3
- **Homepage**: https://epub-reader.freeonlineapps.net/

## Executive Summary

ePub Reader is a legitimate Chrome extension for viewing ePub files in the browser. The extension has a minimal security footprint with only basic storage permissions. Analysis reveals **no critical security vulnerabilities or malicious behavior**. The extension uses standard ePub.js library for rendering books locally, handles file uploads client-side, and only makes external connections for legitimate purposes (welcome/uninstall pages, rating links).

The code is clean, well-structured, and follows secure development practices. No evidence of data exfiltration, tracking, malicious network calls, or suspicious obfuscation was found.

**Overall Risk Level**: CLEAN

## Vulnerability Analysis

### 1. Manifest Permissions & CSP

**Severity**: CLEAN
**Files**: `manifest.json`

**Analysis**:
The extension requests minimal permissions:
- `storage`: Used for persisting user preferences (dark mode, font size, reading method, window dimensions)

No dangerous permissions requested:
- ✓ No `webRequest` or `webRequestBlocking`
- ✓ No `cookies`
- ✓ No host permissions
- ✓ No `tabs` permission in manifest (only dynamically requested with user consent)
- ✓ No content scripts injected into web pages

**Verdict**: CLEAN - Minimal, appropriate permissions for functionality

---

### 2. Background Service Worker

**Severity**: CLEAN
**Files**:
- `js/bg-mv3.js`
- `js/welcome.js`
- `lib/chrome/chrome.js`
- `lib/config.js`
- `lib/common.js`

**Analysis**:

**Background Script Components**:
```javascript
// bg-mv3.js - Simple script loader
importScripts("/js/welcome.js");
importScripts("/lib/config.js");
importScripts("/lib/chrome/chrome.js");
```

**Welcome Page Handler** (`js/welcome.js`):
```javascript
class WelcomePage {
    constructor() {
        let homepage = chrome.runtime.getManifest().homepage_url;
        chrome.runtime.onInstalled.addListener(details => this.onInstalled(details, homepage));
        this.setUninstallURL(homepage);
    }
    onInstalled(details, homepage) {
        if (details.reason != "install" || !homepage) {
            return;
        }
        chrome.tabs.create({
            url: homepage + "/welcome",
        });
    }
    setUninstallURL(homepage) {
        chrome.runtime.setUninstallURL(homepage + "/uninstall");
    }
}
```

**Key Behaviors**:
1. Opens welcome page on installation: `https://epub-reader.freeonlineapps.net/welcome`
2. Sets uninstall URL: `https://epub-reader.freeonlineapps.net/uninstall`
3. Manages internal messaging between background and UI
4. Stores user preferences (dark mode, font size, view method) in chrome.storage.local
5. Opens app UI in new tab when toolbar icon clicked

**No malicious patterns**:
- ✓ No external network requests from background script
- ✓ No XHR/fetch hooking
- ✓ No dynamic code execution (eval, Function())
- ✓ No cookie access
- ✓ No remote configuration loading
- ✓ No extension enumeration/killing

**Verdict**: CLEAN - Standard extension lifecycle management

---

### 3. Content Scripts

**Severity**: CLEAN
**Files**: N/A

**Analysis**:
The extension does not inject any content scripts into web pages. All functionality is contained within the extension's own UI pages.

**Verdict**: CLEAN - No content script injection

---

### 4. Network Communication

**Severity**: CLEAN
**Files**:
- `data/UI/index.js` (lines 50-74)
- `data/UI/index.html` (line 66)
- `js/rate.js`

**Analysis**:

**Domain References Found**:
1. `https://epub-reader.freeonlineapps.net/` - Extension homepage (manifest)
2. `https://epub.freebusinessapps.net/epub-reader` - Logo link in UI (line 66 of index.html)
3. `https://chrome.google.com/webstore/detail/{id}/reviews` - Rating link (generated by rate.js)

**XMLHttpRequest Usage** (index.js, lines 50-74):
```javascript
config.fetch = function (url) {
    if (url !== undefined) {
        config.url = url;
        background.send("url", { "url": config.url });
    }
    if (config.url) {
        config.action.empty();
        config.xhr = new XMLHttpRequest();
        config.xhr.open("GET", config.url, true);
        config.xhr.responseType = "arraybuffer";
        config.xhr.onload = function () { config.render(this.response) };
        config.xhr.send();
    } else config.render('');
};
```

**Context**: This XHR is used **only** for fetching user-specified ePub file URLs. User must:
1. Manually enter a URL
2. Grant explicit permission via `chrome.permissions.request()` (lines 215-218)

**Permission Request Code**:
```javascript
url.addEventListener("change", function (e) {
    if (e.target.value) {
        var option = { "permissions": ["tabs"], "origins": [e.target.value] };
        chrome.permissions.request(option, function (allow) {
            if (allow) config.fetch(e.target.value);
        });
    } else config.fetch('');
}, false);
```

**No evidence of**:
- ✓ No unauthorized data exfiltration
- ✓ No tracking beacons
- ✓ No analytics SDKs
- ✓ No ad injection
- ✓ No market intelligence SDKs (Sensor Tower, Pathmatics, etc.)
- ✓ No remote kill switches or config loading

**Verdict**: CLEAN - User-initiated file fetching with explicit permission

---

### 5. Data Handling & Privacy

**Severity**: CLEAN
**Files**: `data/UI/index.js`, `lib/chrome/chrome.js`

**Analysis**:

**Local Data Storage**:
```javascript
app.storage = (function () {
    var objs = {};
    chrome.storage.local.get(null, function (o) {
        objs = o;
    });
    return {
        "read": function (id) {return objs[id]},
        "write": function (id, data) {
            var tmp = {};
            tmp[id] = data;
            objs[id] = data;
            chrome.storage.local.set(tmp, function () {});
        }
    }
})();
```

**Data Stored Locally**:
- `dark`: UI dark mode preference ("active" / "inactive")
- `size`: Window dimensions (width, height)
- `url`: Last ePub file URL (user-provided)
- `font`: Font size percentage (10-300)
- `method`: Viewing method (scrolled, spreads, etc.)

**File Processing**:
- ePub files are processed entirely client-side using epub.js and jszip.js libraries
- File upload via `<input type="file">` - no server transmission
- ArrayBuffer reading: `reader.readAsArrayBuffer(file);` (line 202)

**No privacy concerns**:
- ✓ No data sent to external servers
- ✓ No user activity tracking
- ✓ No cookie harvesting
- ✓ No clipboard access
- ✓ No keyboard logging
- ✓ No screenshot capture

**Verdict**: CLEAN - All processing is local, no data exfiltration

---

### 6. DOM Manipulation & Injection

**Severity**: CLEAN
**Files**: `data/UI/index.js`, `data/UI/js/Localize.js`

**Analysis**:

**Localization innerHTML Usage** (`Localize.js`, lines 23-27):
```javascript
var valNewH = valStrH.replace(/__MSG_(\w+)__/g, function(match, v1) {
    return v1 ? chrome.i18n.getMessage(v1) : "";
});
if(valNewH != valStrH) {
    obj.innerHTML = valNewH;
}
```

**Context**: This replaces i18n message placeholders (`__MSG_key__`) with localized strings from `chrome.i18n.getMessage()`. Source is trusted (extension's own locale files).

**Dynamic Style Injection** (index.js, lines 76-116):
Creates `<style>` elements in ePub iframe to apply dark mode and font sizing. Content is generated from user preferences, not external sources.

**Verdict**: CLEAN - innerHTML used only for trusted i18n, no XSS risk

---

### 7. Third-Party Libraries

**Severity**: CLEAN
**Files**:
- `data/UI/vendor/epub.js` (19,293 lines)
- `data/UI/vendor/jszip.js` (11,622 lines)
- `data/UI/js/jquery-3.3.1.min.js`
- `data/UI/js/bootstrap.min.js`
- `data/UI/js/popper.js`

**Analysis**:

**Libraries Identified**:
1. **epub.js**: Standard, popular library for rendering ePub files (webpack bundled)
2. **jszip.js**: Standard library for ZIP file handling (ePub files are ZIP archives)
3. **jQuery 3.3.1**: Standard DOM manipulation library
4. **Bootstrap**: Standard UI framework
5. **Popper.js**: Standard positioning library

All libraries are legitimate, widely-used open-source projects used for their intended purposes.

**Verdict**: CLEAN - Standard, legitimate libraries

---

### 8. Obfuscation & Code Quality

**Severity**: CLEAN
**Files**: All JavaScript files reviewed

**Analysis**:

**Code Characteristics**:
- Well-formatted, readable code with clear variable names
- Commented code sections (e.g., disabled context menu feature)
- Standard JavaScript patterns, no suspicious encoding
- No `eval()`, `Function()`, `atob()`, or `fromCharCode()` obfuscation
- Minor debug artifacts (`debugger;` statements in lines 43, 87, 231 of common.js/chrome.js/index.js) - appear to be development leftovers, not anti-debugging

**Verdict**: CLEAN - No malicious obfuscation

---

### 9. Extension Enumeration & Fingerprinting

**Severity**: CLEAN
**Files**: All files reviewed

**Analysis**:
No code found that:
- Enumerates installed extensions
- Attempts to kill/disable other extensions
- Performs browser fingerprinting
- Collects system information

**Verdict**: CLEAN - No fingerprinting or extension manipulation

---

### 10. Dynamic Permissions & Host Access

**Severity**: LOW (informational only)
**Files**: `data/UI/index.js` (lines 213-220)

**Analysis**:

**Optional Permission Request**:
```javascript
url.addEventListener("change", function (e) {
    if (e.target.value) {
        var option = { "permissions": ["tabs"], "origins": [e.target.value] };
        chrome.permissions.request(option, function (allow) {
            if (allow) config.fetch(e.target.value);
        });
    }
}, false);
```

**Behavior**: When user enters an ePub URL, extension requests:
1. `tabs` permission (temporary)
2. Origin permission for that specific URL

This is:
- ✓ User-initiated
- ✓ Explicit permission prompt shown
- ✓ Scoped to specific URL entered by user
- ✓ Legitimate use case (fetching user's ePub file)

**Verdict**: LOW - Legitimate dynamic permission pattern, user controls what URLs are accessed

---

## False Positives Table

| Pattern | Location | Context | Classification |
|---------|----------|---------|----------------|
| `innerHTML` usage | `data/UI/js/Localize.js:31` | i18n message placeholder replacement using trusted `chrome.i18n.getMessage()` | False Positive |
| `debugger;` statements | `lib/common.js:43`, `lib/chrome/chrome.js:87`, `data/UI/index.js:231` | Development artifacts, non-functional in production | False Positive |
| XHR/fetch | `data/UI/index.js:58-72` | User-initiated ePub file fetching with explicit permission | False Positive |
| Dynamic permission request | `data/UI/index.js:215` | User-controlled URL with explicit permission prompt | False Positive |

---

## API Endpoints & External Domains

| Domain/URL | Purpose | Initiation | Risk Level |
|------------|---------|------------|------------|
| `https://epub-reader.freeonlineapps.net/welcome` | Post-install welcome page | Automatic on install | Low |
| `https://epub-reader.freeonlineapps.net/uninstall` | Uninstall feedback | Automatic on uninstall | Low |
| `https://epub.freebusinessapps.net/epub-reader` | Logo link in UI | User click only | Low |
| `https://chrome.google.com/webstore/detail/{id}/reviews` | Extension rating page | User click only | Low |
| User-provided URLs | ePub file fetching | User input + explicit permission | Low |

**Note**: No autonomous network requests occur during normal operation. All external connections are either user-initiated or standard extension lifecycle events.

---

## Data Flow Summary

### Input Sources
1. **Local File Upload**: User selects `.epub` file via `<input type="file">`
2. **URL Entry**: User provides ePub file URL (requires explicit permission)
3. **User Preferences**: Dark mode, font size, view method, window size

### Processing
1. **ePub Parsing**:
   - File read as ArrayBuffer
   - Processed by epub.js library (client-side)
   - Unzipped using jszip.js (client-side)
   - Rendered in iframe within extension page

2. **Preference Storage**:
   - User settings stored in `chrome.storage.local`
   - No synchronization to external servers

### Output Destinations
1. **Local Display**: Rendered content shown only in extension's UI tab
2. **Local Storage**: Preferences saved only to Chrome's local storage
3. **No External Transmission**: No data sent to remote servers

### Data Retention
- Preferences: Persisted in local storage until user clears extension data
- ePub Content: Loaded in memory only, not persisted
- URLs: Last URL stored locally for convenience

---

## Security Strengths

1. **Minimal Attack Surface**: No content scripts, minimal permissions
2. **User Control**: All external URL access requires explicit user permission
3. **Local Processing**: All file processing happens client-side
4. **No Analytics/Tracking**: No telemetry or user tracking observed
5. **No Ad Injection**: Clean UI with no advertisement insertion
6. **Standard Libraries**: Uses well-known, audited open-source libraries
7. **Manifest V3**: Modern manifest version with improved security model
8. **No Remote Code**: No remote script loading or eval usage

---

## Potential Improvements (Non-Security)

1. Remove leftover `debugger;` statements from production code
2. Add Content Security Policy to manifest for defense-in-depth
3. Consider code signing for vendor libraries
4. Add subresource integrity (SRI) checks if loading any CDN resources

---

## Overall Risk Assessment

**RISK LEVEL: CLEAN**

### Risk Breakdown
- **Critical Vulnerabilities**: 0
- **High Vulnerabilities**: 0
- **Medium Vulnerabilities**: 0
- **Low Information Items**: 1 (dynamic permissions - legitimate use)
- **False Positives**: 4

### Conclusion

ePub Reader is a **legitimate, safe extension** for reading ePub files in the browser. The extension:

- Has appropriate, minimal permissions for its functionality
- Processes all files locally without external transmission
- Requests user permission before accessing any external URLs
- Contains no malicious code, tracking, or data exfiltration
- Uses standard, trusted libraries for ePub rendering
- Follows secure development practices

**Recommendation**: SAFE FOR USE

Users can confidently use this extension to read ePub files. The extension does not pose privacy or security risks beyond the standard extension lifecycle interactions (welcome/uninstall pages).

---

**Analysis Date**: 2026-02-07
**Analyst**: Claude Code Security Agent
**Extension Version Analyzed**: 3.0.0
